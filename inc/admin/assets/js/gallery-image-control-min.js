!function($){var e=null,a=$(".raven-gallery-metabox"),t=a.find("#raven_insert_gallery_button"),l=a.find(".raven-galleries-list ul"),n=a.find(".raven-gallery-image-ids"),r=$(".raven-overlay-gallery-button");function i(e){var a=e.val();return""!==a?a.split(",").map((function(e){return parseInt(e)})):[]}$(document).on("ready",(function(){var e,a;e=l,a=n,"media"==="media"&&e.sortable({items:"li.raven-gallery-image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"raven-gallery-sortable-placeholder",tolerance:"pointer",start:function(e,a){a.item.css("border-color","#f6f6f6")},stop:function(e,a){a.item.removeAttr("style")},update:function(t,l){var n=[];e.find("li.raven-gallery-image").each((function(){n.push(parseInt($(this).attr("data-attachment_id")))})),a.val($.unique(n).join(","))}})})),t.add(r).on("click",(function(a){if(a.preventDefault(),e){if(!$(".media-modal").hasClass("raven-edit-modal"))return void e.open();e.detach(),e.dispose(),e=null}$(".media-modal").removeClass("raven-edit-modal"),(e=wp.media({title:raven_gallery_control_args.textOpenTitle,multiple:"add",autoSelect:!0,library:{type:"image"},button:{text:raven_gallery_control_args.textUseImages}})).on("open",(function(){var a=e.state().get("selection"),t=i(n);a.reset(),$.each(t,(function(){attachment=wp.media.attachment(this),a.add(attachment?[attachment]:[])}))})),e.on("select",(function(){var a=e.state().get("selection"),t=i(n),o=[];if(a){a.map((function(e){if(e.id){if(o.push(e.id),-1!==$.inArray(e.id,t))return;t.push(e.id),(e=e.toJSON()).sizes&&e.sizes.thumbnail&&(e.url=e.sizes.thumbnail.url),l.append(raven_gallery_control_args.mediaItemTemplate.replace(/__IMAGE_ID__/g,e.id).replace(/__IMAGE_CLASS__/g,"").replace(/__IMAGE__/g,'<img width="150" height="150" src="'+e.url+'" class="attachment-thumbnail size-thumbnail" alt="" />'))}}));for(var s=t,d=0;d<t.length;d++)-1===$.inArray(t[d],o)&&(l.find('li.raven-gallery-image[data-attachment_id="'+t[d]+'"]').remove(),s=_.without(s,t[d]));n.val($.unique(s).join(",")),r.hide()}})),e.open()})),$(document).on("click",".raven-image-remove",(function(e){if(e.preventDefault(),1===$(this).closest(".raven-gallery-images-featured").length)return!1;var a=$(this).closest("li.raven-gallery-image"),t=i(n),l=$(".raven-gallery-cover-id");return a.data("attachment_id")==l.val()&&l.val(""),t=_.without(t,parseInt(a.data("attachment_id"))),a.remove(),n.val($.unique(t).join(",")),0===t.length&&r.css("display","flex"),!1})),$(".raven-galleries-list").on("click",".raven-image-edit",(function(a){a.preventDefault();var t=$(this).closest("li.raven-gallery-image"),l=parseInt(t.data("attachment_id"));return null!==e&&(e.detach(),e.dispose(),e=null),(e=wp.media({id:"raven-edit-attachment-modal",frame:"select",uploader:!1,multiple:!1,title:raven_gallery_control_args.editTitle,library:{post__in:l},button:{text:raven_gallery_control_args.buttonEditFile}}).on("open",(function(){var a=wp.media.attachment(l),t=e.state().get("selection");e.$el.closest(".media-modal").addClass("raven-edit-modal"),a.fetch(),t.add(a)}))).open(),!1})),$(".raven-galleries-list").on("click",".raven-image-options",(function(e){e.preventDefault();var a=$(this).closest("li.raven-gallery-image"),t=parseInt(a.data("attachment_id"));return $("body").append('<div class="media-modal-backdrop"></div>'),!$(".raven-gallery-image-options-template").length>0&&($.ajax({type:"POST",url:raven_gallery_control_args.ajaxurl,data:{action:"raven_gallery_image_options_template",attachment_id:t,post_id:raven_gallery_control_args.post_id},success:function(e){$("body").append(e),$("#hero_gallery_text_color").wpColorPicker()}}),$("body").addClass("modal-open")),$(document).on("click",".raven-gallery-image-options-submit",(function(e){var a=$("#raven_gallery_image_options_form").serialize(),l=$(".raven-gallery-image-options-template"),n=$(".media-modal-backdrop");$(".media-frame-title h1").find(".spinner").css("visibility","visible"),$.ajax({type:"POST",url:ajaxurl,data:{action:"raven_gallery_image_options_panel_save_actions",security:$("input[name='raven_gallery_image_options_nonce']").val(),attachment_id:t,post_id:raven_gallery_control_args.post_id,form:a},datatype:"html",success:function(e){l.remove(),n.remove(),$("body").removeClass("modal-open")}})})),$(document).on("click",".raven-gallery-image-options-close, .media-modal-backdrop",(function(e){e.preventDefault();var a=$(".raven-gallery-image-options-template"),t=$(".media-modal-backdrop");a.remove(),t.remove(),$("body").removeClass("modal-open")})),!1})),$(document).on("click",".raven-gallery-image-cover",(function(e){e.preventDefault();var a=$(this).closest("li.raven-gallery-image"),t=parseInt(a.data("attachment_id")),l=$(".raven-gallery-cover-id"),n="raven-gallery-cover";l.val()==t?l.val(""):l.val(t),a.hasClass(n)?a.removeClass(n):($(".raven-gallery-image").removeClass(n),a.addClass(n))})),$(document).on("change","input[name=raven_gallery_type]",(function(){var e="."+$(this).data("options"),a=$("#postimagediv"),t=$("#casestudy-hero"),l=$("#postdivrich");$("#gallery_options").find(".raven-fieldset").slideUp(),$(e).slideDown(),".raven-gallery-standard-options"!=e?(a.hide(),t.hide()):(l.show(),a.show(),t.show()),$(document).on("change","#raven_gallery_make_home",(function(){$(this).is(":checked")?(l.hide(),a.hide(),t.hide()):(l.show(),a.show(),t.show())}))}))}(jQuery);